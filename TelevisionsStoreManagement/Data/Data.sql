USE MASTER

drop database TVSTOREMANAGERMENT

CREATE DATABASE TVSTOREMANAGERMENT

GO

USE TVSTOREMANAGERMENT

GO

CREATE TABLE ACCOUNT(
	USERNAME VARCHAR(100) PRIMARY KEY,
	PASSWORD VARCHAR(1000),
	DISPLAYNAME NVARCHAR(100),
	ROLE INT, -- 1: Admin 2: Staff
	IMG VARCHAR(1000),
)

GO

CREATE TABLE CUSTOMER(
	ID INT IDENTITY PRIMARY KEY,
	NAME NVARCHAR(100),
	PHONE_NUMBER VARCHAR(10),
	TYPE INT, -- 1:VIP 2:NORMAL
	PAYCOUNT FLOAT -- >30TR = VIP
)


GO



CREATE TABLE TIVI(
	ID INT IDENTITY PRIMARY KEY,
	CATEGORY_NAME VARCHAR(20),
	NAME NVARCHAR(40),
	TYPE NVARCHAR(40), --1:SMART 2:INTERNET 3:CONG 4:THUONG
	SIZE NVARCHAR(40),
	PRICE_IN FLOAT,
	PRICE_OUT FLOAT,
	COUNT INT,
)

GO

CREATE TABLE BILL_OUT(
	ID INT IDENTITY PRIMARY KEY,
	DATE_CHECKIN DATE,
	ID_CUSTOMER INT,
	TOTALPRICE FLOAT,
	STATUS INT,
	FOREIGN KEY (ID_CUSTOMER) REFERENCES CUSTOMER(ID),
)

GO

CREATE TABLE BILL_INFO(
	ID INT IDENTITY PRIMARY KEY,
	ID_BILL INT,
	ID_TV INT,
	COUNT INT,
	TOTAL_PRICE FLOAT,
	FOREIGN KEY (ID_TV) REFERENCES TIVI(ID),
	FOREIGN KEY (ID_BILL) REFERENCES BILL_OUT(ID)
)

GO

CREATE TABLE REVEN(
	THANG INT,
	VALUE FLOAT
)

GO

INSERT INTO REVEN (THANG , VALUE) VALUES(1, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(2, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(3, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(4, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(5, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(6, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(7, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(8, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(9, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(10, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(11, 140000000)
INSERT INTO REVEN (THANG , VALUE) VALUES(12, 140000000)

SELECT * FROM reven

SELECT PRICE_OUT - PRICE_IN AS PRICE FROM TIVI WHERE ID = 11

UPDATE REVEN SET VALUE = 80000000 WHERE THANG = 5

--CREATE TABLE WAREHOUSE(
--	ID_TV INT,
--	COUNT INT,
--	FOREIGN KEY (ID_TV) REFERENCES TIVI(ID)
--)

--GO

--CREATE TABLE BILL_IN(
--	ID INT IDENTITY PRIMARY KEY,
--	ID_BILL_INFO VARCHAR(1000),
--	DATE_CHECKIN DATE,
--	TOTAL_PRICE FLOAT,
--	STATUS INT,
--	FOREIGN KEY ID_BILL_INFO REFERENCES BILL_INFO(ID)
--)

CREATE PROC USP_Login
@Username nvarchar(100), @Password nvarchar(1000)
AS
BEGIN
	SELECT * FROM dbo.ACCOUNT WHERE USERNAME = @Username AND PASSWORD = @Password
END
GO

USP_Login 'pntn0705' , '1'

UPDATE ACCOUNT SET IMG = '\\IMG\\ACCOUNT\\Num.jpg' where PASSWORD =1

INSERT INTO ACCOUNT(USERNAME, PASSWORD, DISPLAYNAME, ROLE, IMG) VALUES('pntn0705' , '1' , N'Trường Nam' , 1 , '@C:\Users\Num\Documents\GitHub\Do-An-Nam-3\TelevisionsStoreManagement\IMG\ACCOUNT\Num.jpg')

INSERT INTO TIVI(CATEGORY_NAME , NAME , TYPE , SIZE , PRICE_OUT, PRICE_IN , COUNT) VALUES('Panasonic' , N'Bình thường' , '2' , 51 , 6500000 , 4000000 , 20)
INSERT INTO TIVI(CATEGORY_NAME , NAME , TYPE , SIZE , PRICE_OUT, PRICE_IN , COUNT) VALUES('Sony' , N'Bình thường' , '2' , 51 , 6500000 , 4000000 , 20)
INSERT INTO TIVI(CATEGORY_NAME , NAME , TYPE , SIZE , PRICE_OUT, PRICE_IN , COUNT) VALUES('Samsung' , N'Bình thường' , '2' , 51 , 6500000 , 4000000 , 20)
INSERT INTO TIVI(CATEGORY_NAME , NAME , TYPE , SIZE , PRICE_OUT, PRICE_IN , COUNT) VALUES('LG' , N'Bình thường' , '2' , 51 , 6500000 , 4000000 , 20)


insert into WAREHOUSE(ID_TV,COUNT) values (1,20)
insert into CUSTOMER(NAME,PHONE_NUMBER,TYPE,PAYCOUNT) values (N'Nam béo','0918814602',0,0)
insert into CUSTOMER(NAME,PHONE_NUMBER,TYPE,PAYCOUNT) values (N'Khách','1',0,0)



SELECT * FROM CUSTOMER

select * from account where USERNAME = 'pntn0705'

USP_LOGIN 'pntn0705' , '1'

select ID , CATEGORY_NAME , NAME , TYPE , SIZE , PRICE_OUT , COUNT from tivi

delete BILL_INFO where 1=1
delete BILL_OUT where 1=1

select * from BILL_INFO

DELETE TIVI WHERE ID = 8

SELECT * FROM TIVI WHERE CATEGORY_NAME = 'Panasonic' AND NAME = N'BÌNH THƯỜdNG'
INSERT INTO TIVI ( CATEGORY_NAME , NAME , TYPE , SIZE , PRICE_IN , PRICE_OUT , COUNT ) 
VALUES ( 'Samsung' , 'LCD 4K' , 1 , 49 , 15000000 , 22000000 , 20 )

SELECT * FROM BILL_OUT

SELECT T.CATEGORY_NAME , T.NAME, T.PRICE_OUT , I.COUNT , I.TOTAL_PRICE FROM BILL_OUT O, BILL_INFO I, TIVI T WHERE O.ID = I.ID_BILL AND I.ID_TV = T.ID AND ID_BILL = 6

DELETE BILL_INFO WHERE ID_BILL = 5

DELETE BILL_OUT WHERE TOTALPRICE = 0



SELECT * FROM CUSTOMER

SELECT * FROM BILL_OUT , CUSTOMER WHERE BILL_OUT.ID_CUSTOMER = CUSTOMER.ID

UPDATE TIVI SET CATEGORY_NAME = 'Panasonic' , NAME = N'Bình thường' , TYPE = 2 , SIZE = 51 , PRICE_IN = 4000000 , PRICE_OUT = 6500000 , COUNT = 11 WHERE ID = 1




select * from BILL_INFO WHERE ID_TV = 2

DELETE BILL_INFO WHERE ID_TV = 2

DELETE BILL_OUT WHERE ID = 

SELECT ID_BILL FROM	BILL_INFO WHERE ID_TV = 7

SELECT * FROM BILL_OUT

SELECT * FROM TIVI

SELECT ID_BILL FROM BILL_INFO WHERE ID_TV = 

DELETE BILL_INFO WHERE

SELECT MONTH(DATE_CHECKIN) 

SELECT SUM(TOTALPRICE) FROM BILL_OUT WHERE MONTH(DATE_CHECKIN) = (1 to 12) 

select * from reven

	select * from account

UPDATE ACCOUNT SET IMG = '\IMG\ACCOUNT\QWE.PNG' WEHRE USERNAME = 'QWE'

CREATE PROC CHECK_AMOUNT
AS
BEGIN
	SELECT COUNT(*) FROM TIVI WHERE COUNT <= 3
END 

EXECUTE GET_NAME_AMOUNTSMALLER3

CREATE PROC GET_NAME_AMOUNTSMALLER3
AS
BEGIN
	SELECT * FROM TIVI WHERE COUNT <= 3
END

select * from account

delete account where USERNAME = 'staff'

SELECT * FROM BILL_OUT

SELECT MAX(DATE_CHECKIN) FROM BILL_OUT

SELECT SUM(COUNT) FROM BILL_INFO, BILL_OUT WHERE DATE_CHECKIN = '2019-11-03' AND BILL_INFO.ID_BILL = BILL_OUT.ID

select sum(value) from reven

update reven set value = 0 where thang = 12

select * from BILL_OUT

insert into BILL_OUT(date_checkin, id_customer, totalprice, status) values (getdate(), 1, 0, 1)
delete BILL_OUT where totalprice = 0

update bill_out set totalprice = 19500000 , status = 1 where id_customer = 1